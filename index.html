<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Galaxy Hyperdrive</title>
<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
function resize(){
  c.width = innerWidth;
  c.height = innerHeight;
}
addEventListener("resize",resize);
resize();

const CX=()=>c.width/2;
const CY=()=>c.height/2;

/* ===== galaxy disk ===== */
const G = 5000;
const galaxy=[];
for(let i=0;i<G;i++){
  const r=Math.pow(Math.random(),0.4);
  const arm=Math.floor(Math.random()*3);
  galaxy.push({
    r,
    a:r*8+arm*2.1+Math.random()*0.4,
    z:Math.random(),
    h:180+Math.random()*120
  });
}

/* ===== warp stars ===== */
const S=1600;
const stars=[];
function reset(s){
  s.x=(Math.random()-0.5)*2;
  s.y=(Math.random()-0.5)*2;
  s.z=Math.random();
}
for(let i=0;i<S;i++){
  const s={};
  reset(s);
  stars.push(s);
}

let t=0;

function draw(){
  ctx.fillStyle="rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,c.width,c.height);

  const time=t%32;

  // cinematic timeline
  const zoomIn=Math.min(1,time/6);
  const warp=Math.max(0,Math.min(1,(time-7)/6));
  const zoomOut=Math.max(0,Math.min(1,(time-18)/8));

  const zoom=1+zoomIn*6-zoomOut*5;
  const lens=warp*warp*0.6;

  ctx.save();
  ctx.translate(CX(),CY());
  ctx.scale(zoom,zoom);

  /* ===== galaxy ===== */
  galaxy.forEach(s=>{
    const ang=s.a+t*0.08;
    const r=s.r*Math.min(c.width,c.height)*0.48;
    let x=Math.cos(ang)*r;
    let y=Math.sin(ang)*r;

    // gravitational lens
    const d=Math.sqrt(x*x+y*y)+0.001;
    const f=1+lens/(d*0.02);
    x*=f; y*=f;

    ctx.fillStyle=`hsla(${s.h},100%,70%,${1-warp})`;
    ctx.fillRect(x,y,1.1,1.1);
  });
  ctx.restore();

  /* ===== hyperspace ===== */
  if(warp>0){
    stars.forEach(s=>{
      s.z-=0.035*warp;
      if(s.z<0.02)reset(s);

      const x=CX()+s.x/s.z*CX();
      const y=CY()+s.y/s.z*CY();
      const l=(1-s.z)*12*warp;

      ctx.strokeStyle="white";
      ctx.beginPath();
      ctx.moveTo(x,y);
      ctx.lineTo(x-s.x*l,y-s.y*l);
      ctx.stroke();
    });
  }

  t+=0.016;
  requestAnimationFrame(draw);
}

ctx.fillStyle="#000";
ctx.fillRect(0,0,c.width,c.height);
draw();
</script>
</body>
</html>
